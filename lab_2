;====================================================================
; Main.asm file generated by New Project wizard
;
; Created:   Пт апр 23 2021
; Processor: PIC16F877A
; Compiler:  MPASM (Proteus)
;====================================================================

;====================================================================
; DEFINITIONS
;====================================================================

#include <p16f877a.inc>                ; Include register definition file

;====================================================================
; VARIABLES
;====================================================================
;«адаем символьное обозначение €чеек пам€ти, расположенных по адресам 20h, 21h, 22h
COUNT1 	EQU 20h
COUNT2 	EQU 21h
COUNT3 	EQU 22h


;====================================================================
; RESET and INTERRUPT VECTORS
;====================================================================

      ; Reset Vector

;====================================================================
; CODE SEGMENT
;====================================================================

PGM   code
Start
      ; Write your code here
		ORG 0 ;“екущий адрес в ѕ«” - 0

		BSF STATUS,RP0 ;?елаем активной страницу 1, чтобы получить доступ к регистру TRISA
	;;	MOVLW 0x0 ;≈сли все кнопки выключены, выключаем все лампочки
	;	MOVWF TRISB
	;	MOVWF TRISD ;—охран€ем в PORTD
		
		CLRF TRISB ;”станавливаем все выводы порта ¬ на вывод // кнопки
		CLRF TRISD ;”станавливаем все выводы порта D на вывод // лампочки
		BCF STATUS,RP0 ;¬озвращаемс€ на страницу 0
		CLRF PORTD ;»значально все лампочки не гор€т

		MOVLW 0xFF
		MOVWF PORTB
LOOP: 	
	
		BTFSC PORTB,7 ;Eсли нажата кнопка 7, надо проверить нажата ли кнопка 6
		GOTO ALONE ;?сли кнопка 7 не нажата, значит нажата кнопка 6 (но это надо проверить), поэтому включаем четные
		BTFSC PORTB,6 ;?сли нажата кнопка 6, значит пропускаем следующий и идем моргать
		GOTO DOUBLE ;?сли кнопка 6 не нажата, а кнопка 7 нажата, значит включаем нечетные
		GOTO OFF ;?сли пришли сюда значит нажаты обе кнопки


		
ALONE:  	BTFSC PORTB,6 ;≈сли кнопка 6 не горит, значит ничего не горит
		GOTO OFF
		
		MOVLW 0x01 ;ѕодсвечиваем четные
		MOVWF PORTD ;—охран€ем в PORTD
		CALL DELAY
		MOVLW 0x02 ;ѕодсвечиваем четные
		MOVWF PORTD ;—охран€ем в PORTD
		CALL DELAY
		MOVLW 0x04 ;ѕодсвечиваем четные
		MOVWF PORTD ;—охран€ем в PORTD
		CALL DELAY
		MOVLW 0x08 ;ѕодсвечиваем четные
		MOVWF PORTD ;—охран€ем в PORTD
		CALL DELAY
		MOVLW 0x10 ;ѕодсвечиваем четные
		MOVWF PORTD ;—охран€ем в PORTD
		CALL DELAY
		MOVLW 0x20 ;ѕодсвечиваем четные
		MOVWF PORTD ;—охран€ем в PORTD
		CALL DELAY
		MOVLW 0x40 ;ѕодсвечиваем четные
		MOVWF PORTD ;—охран€ем в PORTD
		CALL DELAY
		MOVLW 0x80 ;ѕодсвечиваем четные
		MOVWF PORTD ;—охран€ем в PORTD
		CALL DELAY
		GOTO LOOP ;»дем в начало провер€ть состо€ние кнопок
	 




DOUBLE:		MOVLW 0xC0 ;Cѕодсвечиваем нечетные
		  MOVWF PORTD ;—охран€ем в PORTD
		  CALL DELAY
		  MOVLW 0x30 ;Cѕодсвечиваем нечетные
		  MOVWF PORTD ;—охран€ем в PORTD
		  CALL DELAY
		  MOVLW 0x0C ;Cѕодсвечиваем нечетные
		  MOVWF PORTD ;—охран€ем в PORTD
		  CALL DELAY
		  MOVLW 0x3 ;Cѕодсвечиваем нечетные
		  MOVWF PORTD ;—охран€ем в PORTD
		  CALL DELAY
		GOTO LOOP ;»дем в начало провер€ть состо€ние кнопок


OFF:		MOVLW 0x0 ;≈сли все кнопки выключены, выключаем все лампочки
		MOVWF PORTD ;—охран€ем в PORTD
		GOTO LOOP ;»дем снова на проверку		



		
DELAY: 	MOVLW 0x10
		MOVWF COUNT1
LOOPZ1:	CALL DELAY2
       	DECFSZ COUNT1,F
		GOTO LOOPZ1
		RETURN

DELAY2: MOVLW 0xFF
		MOVWF COUNT2
LOOPZ2: CALL DELAY3
     	DECFSZ COUNT2,F
		GOTO LOOPZ2
		RETURN

DELAY3:	MOVLW 0xFF
		MOVWF COUNT3
LOOPZ3: DECFSZ COUNT3,F
		GOTO LOOPZ3
		RETURN		
		
		


		
Loop  
      goto  Loop

;====================================================================
      END
